<div class="flex items-end justify-between mt-6 mb-4">
  <h2 class="flex items-center text-2xl">
    <mat-icon class="mat-icon-2xl mr-1">swap_vert</mat-icon>
    Sort Players &amp; Set Preferences Below:
  </h2>

  <div class="grid grid-flow-col gap-2">
    @if (position !== positionEnum.QB) {
    <span class="px-2 self-end">
      <span class="text-base text-slate-300">Total Max Usage: </span>
      <span class="font-bold text-xl">
        {{
          position === positionEnum.RB
            ? totalMaxOwnershipForRunningBacks()
            : totalMaxOwnershipForDefenses()
        }}%
      </span>
    </span>
    }
    <button matFab extended (click)="makeSuggestedSelections()">
      <mat-icon>check_box</mat-icon>
      Make Suggested Selections
    </button>

    <button matFab extended (click)="savePlayerSelections()">
      <mat-icon>save</mat-icon>
      Save Selections
    </button>
  </div>
</div>

<!-- TODO: Create reusable component for each position to reduce repeat code -->
@if (quarterbacks.length > 0 ) {
<div
  cdkDropList
  class="sorted-player-list"
  (cdkDropListDropped)="dropQuarterback($event)"
>
  @for (qb of quarterbacks; let i = $index; track qb.id) {
  <div
    class="grid grid-cols-[auto_1fr_auto_auto_auto_auto_auto] gap-4 items-center sorted-player"
    cdkDrag
  >
    <span class="qb-rank sort-order text-2xl">
      {{ i + 1 }}
    </span>
    <div class="ml-1">
      <div class="text-lg font-bold">{{ qb.name }}</div>
      <span class="text-slate-300 text-sm inline-flex">
        {{ qb.salary | currency : 'USD' : 'symbol' : '1.0-0' }}

        <span class="px-1">&bull;</span>
        <span>
          {{ qb.gameInfo }}
          &bull;
          {{ qb.projectedPointsAvg | number : '1.0-1' }} Pts &bull;
          {{ qb.projectedPointsPerDollar | number : '1.3-3' }}
          <span class="text-xs">PTS/$100</span>
        </span>
      </span>
    </div>

    <mat-form-field class="w-[90px] self-end">
      <mat-label>Grade</mat-label>
      <input
        min="0"
        max="10"
        step="0.1"
        matInput
        [value]="quarterbacks[i].gradeOutOfTen"
        (input)="quarterbacks[i].gradeOutOfTen = $any($event.target).value"
        type="number"
      />
    </mat-form-field>

    <mat-form-field class="w-[90px] self-end">
      <mat-label>Lineups</mat-label>
      <input
        matInput
        [value]="quarterbacks[i].numberOfLineupsWithThisPlayer"
        (input)="
          quarterbacks[i].numberOfLineupsWithThisPlayer = $any(
            $event.target
          ).value
        "
        type="number"
      />
    </mat-form-field>

    <div>
      <mat-label class="block mb-1 text-center text-gray-300">
        Teammate Pass Catchers
      </mat-label>
      <div>
        <mat-form-field class="w-[95px] mb-0">
          <mat-label>Min</mat-label>
          <mat-select
            [(value)]="quarterbacks[i].minNumberOfTeammatePasscatchers"
          >
            <mat-option [value]="0">0</mat-option>
            <mat-option [value]="1">1</mat-option>
            <mat-option [value]="2">2</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field class="ml-2 w-[95px] mb-0">
          <mat-label>Max</mat-label>
          <mat-select
            [(value)]="quarterbacks[i].maxNumberOfTeammatePasscatchers"
          >
            <mat-option [value]="0">0</mat-option>
            <mat-option [value]="1">1</mat-option>
            <mat-option [value]="2">2</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>

    <div class="grid h-[56px] self-end items-center">
      <mat-slide-toggle
        name="requirePlayerFromOpposingTeam"
        [checked]="quarterbacks[i].requirePlayerFromOpposingTeam"
        (change)="
          quarterbacks[i].requirePlayerFromOpposingTeam =
            !quarterbacks[i].requirePlayerFromOpposingTeam
        "
      >
        Require Opp. Player
      </mat-slide-toggle>
    </div>

    <div class="grid h-[56px] self-end items-center delete-icon-button">
      <button
        aria-label="remove player button"
        class="text-red-600"
        (click)="removePlayerFromPool(qb, position)"
        matIconButton
      >
        <mat-icon>delete</mat-icon>
      </button>
    </div>
  </div>
  }
</div>
} @else if (runningBacks.length > 0 ){
<div
  cdkDropList
  class="sorted-player-list"
  (cdkDropListDropped)="dropRunningBack($event)"
>
  @for (rb of runningBacks; let i = $index; track rb.id) {
  <div
    class="grid grid-cols-[auto_1fr_auto_auto_auto_auto] gap-4 items-center sorted-player"
    cdkDrag
  >
    <span class="rb-rank sort-order text-2xl shadow-md shadow-gray-800">
      {{ i + 1 }}
    </span>
    <div class="ml-1">
      <div class="text-lg font-bold">{{ rb.name }}</div>
      <span class="text-slate-300 text-sm inline-flex">
        {{ rb.salary | currency : 'USD' : 'symbol' : '1.0-0' }}

        <span class="px-1">&bull;</span>
        <span>
          {{ rb.gameInfo }}
          &bull;
          {{ rb.projectedPointsAvg | number : '1.0-1' }} Pts &bull;
          {{ rb.projectedPointsPerDollar | number : '1.3-3' }}
          <span class="text-xs">PTS/$100</span>
        </span>
      </span>
    </div>

    <mat-form-field class="w-[90px] self-end">
      <mat-label>Grade</mat-label>
      <input
        min="0"
        max="10"
        step="0.1"
        matInput
        [value]="runningBacks[i].gradeOutOfTen"
        (input)="runningBacks[i].gradeOutOfTen = $any($event.target).value"
        type="number"
      />
    </mat-form-field>

    <div>
      <mat-label class="block mb-1 text-center text-gray-300">
        General Usage
      </mat-label>

      <div>
        <mat-form-field class="w-[90px] mb-0">
          <mat-label>Min</mat-label>
          <input
            min="0"
            max="70"
            matInput
            [value]="runningBacks[i].minOwnershipPercentage"
            (input)="
              runningBacks[i].minOwnershipPercentage = $any($event.target).value
            "
            type="number"
          />
          <span class="pl-1" matTextSuffix>&#37;</span>
        </mat-form-field>

        <mat-form-field class="ml-2 w-[90px] mb-0">
          <mat-label>Max</mat-label>
          <input
            (change)="updateOwnership()"
            min="0"
            max="90"
            matInput
            [value]="runningBacks[i].maxOwnershipPercentage"
            (input)="
              runningBacks[i].maxOwnershipPercentage = $any($event.target).value
            "
            type="number"
          />
          <span class="pl-1" matTextSuffix>&#37;</span>
        </mat-form-field>
      </div>
    </div>

    <!-- <mat-slide-toggle
      name="allowRBFromOpposingTeam"
      [checked]="runningBacks[i].allowRBFromOpposingTeam"
      (change)="
        runningBacks[i].allowRBFromOpposingTeam =
          !runningBacks[i].allowRBFromOpposingTeam
      "
    >
      Allow RB From Opponent
    </mat-slide-toggle> -->

    <!-- <mat-slide-toggle
      name="useAsAlternate"
      [checked]="runningBacks[i].useAsAlternate"
      (change)="
        runningBacks[i].useAsAlternate = !runningBacks[i].useAsAlternate
      "
    >
      Use As Alternate
    </mat-slide-toggle> -->

    <div class="gap-2 grid self-end">
      <mat-slide-toggle
        name="onlyUseInLargerFieldContests"
        [checked]="runningBacks[i].onlyUseInLargerFieldContests"
        (change)="
          runningBacks[i].onlyUseInLargerFieldContests =
            !runningBacks[i].onlyUseInLargerFieldContests
        "
      >
        Large Field Only
      </mat-slide-toggle>

      <mat-slide-toggle
        name="allowOnlyAsFlex"
        [checked]="runningBacks[i].allowOnlyAsFlex"
        (change)="
          runningBacks[i].allowOnlyAsFlex = !runningBacks[i].allowOnlyAsFlex
        "
      >
        Flex Only
      </mat-slide-toggle>
    </div>

    <div class="grid h-[56px] self-end items-center delete-icon-button">
      <button
        aria-label="remove player button"
        class="text-red-600"
        (click)="removePlayerFromPool(rb, position)"
        matIconButton
      >
        <mat-icon>delete</mat-icon>
      </button>
    </div>
  </div>
  }
</div>
} @else if (dsts.length > 0 ){
<div
  cdkDropList
  class="sorted-player-list"
  (cdkDropListDropped)="dropDst($event)"
>
  @for (dst of dsts; let i = $index; track dst.id) {
  <div
    class="grid grid-cols-[auto_1fr_auto_auto_auto] gap-4 items-center sorted-player"
    cdkDrag
  >
    <span class="dst-rank sort-order text-2xl">
      {{ i + 1 }}
    </span>
    <div class="ml-1">
      <div class="text-lg font-bold">{{ dst.name }}</div>
      <span class="text-slate-300 text-sm inline-flex">
        {{ dst.salary | currency : 'USD' : 'symbol' : '1.0-0' }}

        <span class="px-1">&bull;</span>
        <span>
          {{ dst.gameInfo }}
          &bull;
          {{ dst.projectedPointsAvg | number : '1.0-1' }} Pts &bull;
          {{ dst.projectedPointsPerDollar | number : '1.3-3' }}
          <span class="text-xs">PTS/$100</span>
        </span>
      </span>
    </div>

    <mat-form-field class="w-[90px] self-end">
      <mat-label>Grade</mat-label>
      <input
        min="0"
        max="10"
        step="0.1"
        matInput
        [value]="dsts[i].gradeOutOfTen"
        (input)="dsts[i].gradeOutOfTen = $any($event.target).value"
        type="number"
      />
    </mat-form-field>

    <div>
      <mat-label class="block mb-1 text-center text-gray-300">
        General Usage
      </mat-label>

      <div>
        <mat-form-field class="w-[90px] mb-0">
          <mat-label>Min</mat-label>
          <input
            min="0"
            max="70"
            matInput
            [value]="dsts[i].minOwnershipPercentage"
            (input)="dsts[i].minOwnershipPercentage = $any($event.target).value"
            type="number"
          />
          <span class="pl-1" matTextSuffix>&#37;</span>
        </mat-form-field>

        <mat-form-field class="ml-2 w-[90px] mb-0">
          <mat-label>Max</mat-label>
          <input
            (change)="updateOwnership()"
            min="0"
            max="90"
            matInput
            [value]="dsts[i].maxOwnershipPercentage"
            (input)="dsts[i].maxOwnershipPercentage = $any($event.target).value"
            type="number"
          />
          <span class="pl-1" matTextSuffix>&#37;</span>
        </mat-form-field>
      </div>
    </div>
    <div class="grid h-[56px] self-end items-center delete-icon-button">
      <button
        aria-label="remove player button"
        class="text-red-600"
        (click)="removePlayerFromPool(dst, position)"
        matIconButton
      >
        <mat-icon>delete</mat-icon>
      </button>
    </div>
  </div>
  }
</div>
} @else { Begin by either selecting players individually from above, or click
"Make Suggested Selections" to automatically add recommended players to your
pool. }
